<!-- TOC -->

- [1. å‰è¨€](#1-å‰è¨€)
- [2. ç¬¬ä¸€ç«  åŠ£è´¨ä»£ç å¸¦æ¥çš„åŠ£è´¨ä½“éªŒ](#2-ç¬¬ä¸€ç« -åŠ£è´¨ä»£ç å¸¦æ¥çš„åŠ£è´¨ä½“éªŒ)
    - [2.1. å‘½åç±»é—®é¢˜](#21-å‘½åç±»é—®é¢˜)
        - [2.1.1. æ²¡æœ‰è€ƒè™‘è°ƒç”¨æ—¶çš„æƒ…å½¢](#211-æ²¡æœ‰è€ƒè™‘è°ƒç”¨æ—¶çš„æƒ…å½¢)
        - [2.1.2. å‘½åç”¨è¯ä¸å½“](#212-å‘½åç”¨è¯ä¸å½“)
        - [2.1.3. å¦å®šå¼å‘½å](#213-å¦å®šå¼å‘½å)
    - [2.2. ç»“æ„ç±»é—®é¢˜](#22-ç»“æ„ç±»é—®é¢˜)
        - [2.2.1. switch-case å¼•èµ·çš„é•¿åˆ†æ”¯](#221-switch-case-å¼•èµ·çš„é•¿åˆ†æ”¯)
        - [2.2.2. è«åå…¶å¦™çš„default](#222-è«åå…¶å¦™çš„default)
        - [2.2.3. ä¸å¿…è¦çš„Guardä»£ç ](#223-ä¸å¿…è¦çš„guardä»£ç )
        - [2.2.4. åµŒå¥—è¿‡æ·±](#224-åµŒå¥—è¿‡æ·±)
- [3. ç¬¬äºŒç«  åŠ£è´¨ä»£ç æ˜¯æ€ä¹ˆäº§ç”Ÿçš„](#3-ç¬¬äºŒç« -åŠ£è´¨ä»£ç æ˜¯æ€ä¹ˆäº§ç”Ÿçš„)
    - [3.1. å®šå¼æ€ç»´](#31-å®šå¼æ€ç»´)
    - [3.2. è®¤ä¸ºçŠ¶æ€åªæœ‰é‡‡ç”¨æ•´æ•°å®šä¹‰](#32-è®¤ä¸ºçŠ¶æ€åªæœ‰é‡‡ç”¨æ•´æ•°å®šä¹‰)
    - [3.3. å¯¹è®¾è®¡æ–¹æ³•ä¸äº†è§£](#33-å¯¹è®¾è®¡æ–¹æ³•ä¸äº†è§£)
    - [3.4. ç¼–ç¨‹ä¹ æƒ¯ä¸ä½³](#34-ç¼–ç¨‹ä¹ æƒ¯ä¸ä½³)
        - [3.4.1. æ²¡æœ‰ç®¡ç†å¥½ä»£ç çš„èŒè´£](#341-æ²¡æœ‰ç®¡ç†å¥½ä»£ç çš„èŒè´£)
- [4. ç¬¬å…­ç«  ç¼–ç¨‹è¯­è¨€çš„å­¦ä¹ ](#4-ç¬¬å…­ç« -ç¼–ç¨‹è¯­è¨€çš„å­¦ä¹ )
    - [4.1. ç®€åŒ–çš„æ ¡éªŒæ¨¡å‹](#41-ç®€åŒ–çš„æ ¡éªŒæ¨¡å‹)
    - [4.2. ç®€åŒ–çš„æƒé™æ¨¡å‹](#42-ç®€åŒ–çš„æƒé™æ¨¡å‹)
- [5. ç¬¬7ç«  è®¾è®¡æ–¹æ³•çš„å­¦ä¹ ](#5-ç¬¬7ç« -è®¾è®¡æ–¹æ³•çš„å­¦ä¹ )
    - [5.1. è®¾è®¡æ¨¡å¼](#51-è®¾è®¡æ¨¡å¼)
    - [5.2. é‡‡ç”¨ä½æ©ç å‡å°‘ç±»çš„ä¸ªæ•°](#52-é‡‡ç”¨ä½æ©ç å‡å°‘ç±»çš„ä¸ªæ•°)
        - [5.2.1. ä½æ©ç ](#521-ä½æ©ç )
        - [æ›¿ä»£å¤šæ€](#æ›¿ä»£å¤šæ€)
        - [æ›¿ä»£å¤šæ€æšä¸¾](#æ›¿ä»£å¤šæ€æšä¸¾)
- [ç¬¬ 9 ç«  ç¼–ç¨‹ä¹ æƒ¯çš„æ”¹è¿›](#ç¬¬-9-ç« -ç¼–ç¨‹ä¹ æƒ¯çš„æ”¹è¿›)
    - [ç»“æ„æ–¹é¢çš„æ”¹è¿›](#ç»“æ„æ–¹é¢çš„æ”¹è¿›)
        - [ç¼©çŸ­é•¿åˆ¤å®š](#ç¼©çŸ­é•¿åˆ¤å®š)
        - [ç¼©çŸ­é•¿åˆ†æ”¯](#ç¼©çŸ­é•¿åˆ†æ”¯)
        - [å‡å°‘å‚æ•°ä¸ªæ•°](#å‡å°‘å‚æ•°ä¸ªæ•°)
        - [å‡å°‘åµŒå¥—çš„å±‚æ•°](#å‡å°‘åµŒå¥—çš„å±‚æ•°)
    - [åˆ†ç¦»æš§æ˜§å…³ç³»](#åˆ†ç¦»æš§æ˜§å…³ç³»)
        - [å¾ªç¯å¼•ç”¨](#å¾ªç¯å¼•ç”¨)
        - [é—´æ¥ç»§æ‰¿](#é—´æ¥ç»§æ‰¿)
    - [å¤šç»´åº¦å˜åŒ–](#å¤šç»´åº¦å˜åŒ–)
    - [è‡ªç›¸ä¼¼å¯¹è±¡](#è‡ªç›¸ä¼¼å¯¹è±¡)
- [6. å…¶ä»–](#6-å…¶ä»–)
    - [6.1. éšæœºæä¾›å™¨](#61-éšæœºæä¾›å™¨)
    - [åœ¨æ—§ä»£ç åŸºç¡€ä¸Šæ‰©å±•ç±»ä¼¼åŠŸèƒ½](#åœ¨æ—§ä»£ç åŸºç¡€ä¸Šæ‰©å±•ç±»ä¼¼åŠŸèƒ½)

<!-- /TOC -->
# 1. å‰è¨€

æ¯”è¾ƒç³Ÿç³•çš„ä»£ç çš„å†™æ³•æ¯”å¦‚:

```java
scene.find(hero, enemy, Kongfu.FIST);//éƒ½ä¸çŸ¥é“è°æ‰“äº†è°
```

æ™®é€šæ–¹å¼ä¹¦å†™çš„ä»£ç :

```java
hero.fight(enemey, Kongfu.FIST);//çŸ¥é“ä»£ç çš„æ„æ€,ä½†æ˜¯é˜…è¯»ä½“éªŒè¿˜ä¸å¤Ÿå¥½
```

è€Œè‡ªè¡¨è¾¾çš„æ–¹å¼ä¹¦å†™çš„ä»£ç å¦‚

```java
hero.fight(enemy).with("FIST)";//å¦‚æœä¸çœ‹é‚£äº›ç¬¦å·,è¯»èµ·æ¥å°±æ˜¯ä¸€å¥è¯
```

-----------


# 2. ç¬¬ä¸€ç«  åŠ£è´¨ä»£ç å¸¦æ¥çš„åŠ£è´¨ä½“éªŒ

åœ¨é˜…è¯»ä¹¦å†™ä¸å¤Ÿç²¾è‰¯çš„ä»£ç æ—¶,è¯»è€…çš„è¡Œä¸ºåŸºæœ¬èƒ½å¤Ÿåæ˜ å‡ºä»£ç å­˜åœ¨çš„é—®é¢˜:

- ä¸€ç›´æ»šåŠ¨é¼ æ ‡æ»šè½® -- æ–¹æ³•è¿‡é•¿
- æ€»æ˜¯å…¨å±€æœç´¢ -- æ–¹æ³•è¿‡é•¿
- åå¤åœ°æŸ¥çœ‹æ–¹æ³•å®ç° -- å‘½åæ— æ³•åæ˜ å…¶çœŸå®å«ä¹‰
- ä¸åœåœ°æŸ¥çœ‹è°ƒç”¨æ–¹æ³•å®ç° -- è°ƒç”¨å±‚æ•°å¤ªå¤š
- ç”»æµç¨‹å›¾ -- åµŒå¥—å¤ªæ·±

> å—¯ ç†è§£æ¡†æ¶çš„æ—¶å€™, é‡åˆ°äº†æŸäº›æ–¹æ³•éš¾äºç†è§£çš„æ—¶å€™, ä¸å¦¨å¾€ä¸Šé¢æ€è€ƒ, æ˜¯æœ¬èº«ä½ çš„èƒ½åŠ›ä¸è¶³ä»¥ç†è§£è¿˜æ˜¯å®ƒæœ¬èº«å†™çš„å°±æœ‰é—®é¢˜.

## 2.1. å‘½åç±»é—®é¢˜

### 2.1.1. æ²¡æœ‰è€ƒè™‘è°ƒç”¨æ—¶çš„æƒ…å½¢

å¦‚æœè¦å»ºç«‹ä¸€ä¸ªç­çº§(Grade)ç±»,é‚£ä¹ˆè·å¾—å­¦ç”Ÿæ•°é‡è¯¥ç”¨ä¸‹é¢å“ªç§å‘½åå‘¢?

```java
//ä¸ç†æƒ³çš„å®ç°
grade.getStudentsCount(); // è¿™ä¸ªgetæœ‰äº›å¤šä½™
grade.countStudents(); // è¿™æ˜¯ä¸€ä¸ªè¡Œä¸º,ç»™äººä¸€ç§"éœ€è¦æ—¶é—´"è®¡ç®—å‡ºæ¥çš„æ„Ÿå—
grade.students.size(); // è¿™æ ·æ¯”è¾ƒä¸å®¹æ˜“ç†è§£, ä½†æ˜¯ä¹¦å†™æœ€ç®€å•,å›¾çœäº‹è€Œç›´æ¥æŠŠstudentså±æ€§å…¬å¼€å¹¶ä¸æ˜¯ä¸€ç§å¥½çš„åšæ³•
grade.size(); // æœ‰è¢«è¯¯è§£ä¸º"ç­çº§çš„æˆ¿é—´å¤§å°"çš„å¯èƒ½

//å®Œç¾åœ°å®ç°
grade.studentsCount(); // èƒ½å¤Ÿæœ€ç›´æ¥åœ°åæ˜ è¿™ä¸ªè¦æ±‚

```

### 2.1.2. å‘½åç”¨è¯ä¸å½“

- research ä¸èƒ½è¡¨ç¤ºé‡æ–°æ£€ç´¢, åº”è¯¥ç”¨searchAgain
- limit è¡¨ç¤ºæé™è€Œä¸æ˜¯é™åˆ¶, restrictionæˆ–è€…constraintæ‰è¡¨ç¤ºé™åˆ¶
- fasten è¡¨ç¤ºå›ºå®šè€Œä¸æ˜¯åŠ é€Ÿ, åº”è¯¥ç”¨accelerate

> è‹±è¯­æ²¡å­¦å¥½....

### 2.1.3. å¦å®šå¼å‘½å

æœ‰ä¸ªå˜é‡`hardKeyboardHidden`è¡¨ç¤ºæ²¡æœ‰æ¥å…¥ç¡¬é”®ç›˜.é‚£ä¹ˆ,åœ¨åˆ¤å®šè½¯é”®ç›˜æ˜¯å¦æ˜¾ç¤ºæ—¶,æ¡ä»¶åˆ¤å®šå¼å†™æˆè¿™æ ·:

```java
if (hardKeyboardHidden == 0) return false;
```

ä¼°è®¡è¯»èµ·æ¥å¾—è´¹ä¸Šä¸€ä¼šå„¿åŠŸå¤«æ‰èƒ½å¤Ÿç†è§£å§
```java
if (hardKeyboard.isConnected())
```
å°±æ²¡æœ‰é‚£ä¹ˆå¤šç–‘æƒ‘äº†
å½“ç„¶,è¿™éœ€è¦æ•´ä½“æ¡†æ¶çš„è°ƒæ•´æ‰èƒ½å¤Ÿå®ç°.


## 2.2. ç»“æ„ç±»é—®é¢˜

### 2.2.1. switch-case å¼•èµ·çš„é•¿åˆ†æ”¯

```java
    public boolean onKeyDown(int keyCode, KeyEvent event){
        switch (keyCode){
            case KeyEvent.KEYCODE_ENTER :
                break;
            case KeyEvent.KEYCODE_SPACE :
                break;
            case KeyEvent.KEYCODE_LEFT :
                break;
            case KeyEvent.KEYCODE_RIGHT :
                break;
            case KeyEvent.KEYCODE_UP :
                break;
            case KeyEvent.KEYCODE_DOWN :
                break;
            case KeyEvent.KEYCODE_BUTTON_1 :
                break;
            case KeyEvent.KEYCODE_BUTTON_2 :
                break;
            case KeyEvent.KEYCODE_BUTTON_3 :
                break;
            case KeyEvent.KEYCODE_BUTTON_4 :
                break;
            ......

            return false;

        }
    }

```

å…¶å®è¿™äº›æ¡ˆä»¶éƒ½æœ‰ä¸€å®šçš„è§„å¾‹å¯å¾ª,å¦‚æœæŒ‰ç…§è§„å¾‹æ¥æ¢åˆ†æŒ‰é”®çš„è¯,ä»£ç å°±ä¼šç®€ç»ƒå¾—å¤š.

```java
    public boolean onKeyDown(int keyCode, KeyEvent event){
        if (event.isPrintintKey()){
            return appendInput(keyCode);
        }else if (isArrowKey(keyCode)){
            return moveCursor(keyCode);
        }else if (isChannelKey(keyCode)){
            return appendInput(convertChannelToNumber(keyCode));
        }else  if (isFunctionKey(keyCode)){
            return processFuntionalKey(keyCode);
        }
        
        return false;
    }

```

è¿™æ ·,é€šè¿‡ç®€åŒ–ä¸Šå±‚å¤„ç†,æŠŠå„ç§å¤„ç†é€»è¾‘åˆ†æ•£åˆ°å„ä¸ªå°çš„æ–¹æ³•ä¸­å®Œæˆ,å¯¹å¯è¯»æ€§çš„æ”¹å–„æ•ˆæœæ˜¯å¾ˆæ˜æ˜¾çš„.

### 2.2.2. è«åå…¶å¦™çš„default

åœ¨switch-caseä¸­,defaultè¯­å¥ä»£è¡¨æ²¡æœ‰è¢«åˆ—å‡ºçš„caseçš„å¤„ç†.ä½†æ˜¯å¯¹äºæœ‰é™å–å€¼èŒƒå›´çš„æƒ…å½¢,åœ¨åˆ—å‡ºæ‰€æœ‰çš„caseä¹‹å,è¿˜æœ‰å¤šåˆ—ä¸€ä¸ªè¶…å‡ºå–å€¼èŒƒå›´çš„default.é‡åˆ°è¿™ç§æƒ…å†µçš„ç¨‹åºå‘˜ç”±äºæ— æ³•ç¡®å®šdefaultåº”è¯¥æ€ä¹ˆå¤„ç†,ä¸€èˆ¬é‡‡å–ç›´æ¥returnè¿”å›.ä½†æ˜¯å¯¹äºéœ€è¦è¿”å›å€¼çš„æ–¹æ³•æ¥è¯´,return 0;æˆ–è€…return false;éƒ½æ˜¯å¯èƒ½å¼•å‘é”™è¯¯çš„å¤„ç†æ–¹å¼.

```java
   public enum State{
        CREATED, UPDATED, DELETED;
    }
    
    public void process(State state){
        switch (state){
            case CREATED:
                break;
            case UPDATED:
                break;
            case DELETED:
                break;
            default://è¿™ä¸ªåˆ†æ”¯æ°¸è¿œä¸ä¼šå‘ç”Ÿ
                break;
        }
    }

```

è¿™ç§æƒ…å†µå¯ä»¥åˆ©ç”¨å¤šæ€æ–¹å¼æ¥å¤„ç†,ä¸‹é¢çš„ä¾‹å­é‡‡ç”¨äº†æšä¸¾,ä¹Ÿå¯ä»¥ç”¨æ¥å£æ´¾ç”Ÿçš„æ–¹æ³•.

```java
   public enum State{
        CREATED{
            public void process(){
                
            }
        },
        UPDATED{
            public void process(){

            }
        },
        DELETED{
            public void process(){

            }
        };

    } 
    
    public void process(State state){
        state.process();
    }

```
è¿™æ ·ç”±äºStateçš„å–å€¼èŒƒå›´æœ‰é™,ä¸ä¼šå‡ºç°å…¶ä»–æƒ…å†µ.æ‰€ä»¥,å°±ä¸å¿…è€ƒè™‘defaultçš„æƒ…å½¢äº†.



### 2.2.3. ä¸å¿…è¦çš„Guardä»£ç 

ä¸€èˆ¬æ¥è¯´,ä¸ºäº†é˜²æ­¢ä¼ å…¥çš„å‚æ•°æ˜¯null, é‡‡å–Guardä»£ç é˜²æ­¢NullPointExceptionå¼‚å¸¸å‘ç”Ÿæ˜¯ä¸€ç§å¸¸è§çš„åšæ³•.ä½†æ˜¯å¦‚æœå¯ä»¥ç¡®ä¿ä¼ å…¥çš„å‚æ•°ä¸æ˜¯null,åˆ™æ²¡å¿…è¦è¿›è¡Œæ ¡éªŒ.å¯¹äºé•¿åº¦çš„æ ¡éªŒä¹Ÿæ˜¯ä¸€æ ·çš„.

```java

public void process(Object object){
    if (object == nul){
        return;
    }

    //process......
}
```

ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢è¿™æ ·æ¥é¿å…ä½¿ç”¨nullåˆ¤å®š:

```java
Object object = ObjectFactory.create();
process(object);
```

åœ¨å·¥å‚ç±»ObjectFatoryä¸­ç¡®ä¿objectä¸ä¸ºnull;

> æ¦‚æ‹¬èµ·æ¥å°±æ˜¯è°ƒç”¨çš„ä¸Šå±‚å·²ç»åšå¥½å¤„ç†,ä¸‹å±‚ç›´æ¥ç”¨å°±å¥½,ä¸éœ€è¦è€ƒè™‘å…¶ä»–å¾·å°”æ¡ä»¶, ä¸å¢åŠ è´Ÿæ‹…

### 2.2.4. åµŒå¥—è¿‡æ·±

```java

    public void render(){
        for (int i = 0; i < MAX_ROW; i++) {
            for (int j = 0; j < MAX_COLUM; j++) {
                if (balls[i][j].state != DESTROYED){
                    if (balls[i][j].state == SELECTED){
                        Color color = getLightColor(balls[i][j].color);
                        display(i, j, color);
                    } else {
                        Color color = getColor(balls[i][j].color);
                        display(i, j, color);
                    }
                }
            }
        }
    } 

```

å½“ä»£ç åµŒå¥—è¿™ä¹ˆæ·±æ—¶,ç†è§£ä»£ç å°±å˜å¾—ä¸å®¹æ˜“äº†.å¯¹äºä¸Šè¿°ä¾‹å­å¦‚æœæŠŠballsçš„äºŒç»´æ•°ç»„æ”¹æˆä¸€ç»´æ•°ç»„,ç„¶åæŠŠçŠ¶æ€ä½œä¸ºBallç±»çš„ä¸€ä¸ªå±æ€§,åµŒå¥—å°±ä¼šä¸€ä¸‹å­å‡å°‘å¾ˆå¤šå±‚.ä¾‹å¦‚

```java
    public void process(){
        for (Ball ball : balls){
            ball.render();
        }
    }
    
    public class Ball{
        public int x;
        public int y;
        public State state;
        public Color lightColor;
        public Color darkColor;
        public void render(){
            state.render(this);
        }
        
        public enum State{
            DESTROYED{
              public void render(Ball ball){
                  
              }  
            },
            SELECTED{
                public void render(Ball ball){
                    display(ball.x, ball.y, ball.lightColor);
                }
            },
            NORMAL{
                public void render(Ball ball){
                    display(ball.x, ball.y, ball.darkColor);
                }
            };
            
            public void render(Ball ball){
                
            }
        }
    }

```


# 3. ç¬¬äºŒç«  åŠ£è´¨ä»£ç æ˜¯æ€ä¹ˆäº§ç”Ÿçš„


## 3.1. å®šå¼æ€ç»´

ä¾‹å¦‚,æ ¼æ–—æ¸¸æˆä¸­, å•å‡»`è½»æ‹³`æŒ‰é’®,åœ¨ä¸åŒçš„æƒ…å†µä¸‹æ‰€å±•ç¤ºçš„å›¾åƒä¼šä¸åŒ.ä¸€èˆ¬ä¼šå€¾å‘äºæŒ‰ç…§è¿™ç§ç»“æ„æ¥å®ç°ä»£ç .

```java
public class Warrior{
    public void fight(){
        if (æ¡ä»¶1){
            //å¤„ç†1
        } else if (æ¡ä»¶2){
            //å¤„ç†2
        } else if (æ¡ä»¶3){
            //å¤„ç†3
        }
        
    }
}
 
 
```

ä½†æ˜¯,å¯¹äºè¿™ç§æƒ…å†µæ¥è¯´,å°†`è½»æ‹³`é‡‡ç”¨å¤šæ€æ¥å¤„ç†,æ ¹æ®æƒ…å†µé€šè¿‡Factoryåˆ›å»ºä¸åŒçš„`è½»æ‹³`å¯¹è±¡,ä»è€Œè¿›è¡Œæ”»å‡»å¤„ç†çš„è¯,ä»£ç å°±å˜å¾—æ›´ä¸ºæ˜“è¯»,æ˜“æ‡‚ä¸”å®¹æ˜“æ‰©å±•äº†.

```java

    public class Warrior{
        public Attackable fist;
        public void fight(){
            FistFactory.create().attack();
        }
    }
    
    public interface Attackable{
        public void attack();
    } 
    
    publicic class LightFist implements Attackable{

        @Override
        public void attack() {
            //å¤„ç†1
        }
    }

    publicic class SuperLightFist implements Attackable{

        @Override
        public void attack() {
            //å¤„ç†2
        }
    }

    publicic class LiteFist implements Attackable{

        @Override
        public void attack() {
            //å¤„ç†3
        }
    }
    
    public class FistFactory{
        public static Attackable create(){
            if (æ¡ä»¶1){
                return new LightFist();
            }else if (æ¡ä»¶2){
                return new SuperLightFist();
            }else if (æ¡ä»¶3){
                return new LightFist();
            }
            return null;
        }
    }
```

å½“éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„æ”»å‡»æ–¹å¼æ—¶,åªè¦å¯¹ä¸Šè¿°Attackableæ¥å£è¿›è¡Œå®ç°,å¹¶ä¸”FistFactoryç±»ä¸­è¿›è¡Œæ³¨å†Œå³å¯.è€Œä»é˜…è¯»ä¸Šæ¥è¯´,ä¸Šå±‚ä»£ç å¹¶ä¸éœ€è¦å…³å¿ƒå½“å‰çš„æ˜¯å“ªä¸ªæ”»å‡»å¯¹è±¡,åªè¦è°ƒç”¨å…¶æ–¹æ³•attackå³å¯.

## 3.2. è®¤ä¸ºçŠ¶æ€åªæœ‰é‡‡ç”¨æ•´æ•°å®šä¹‰

ä¾‹å¦‚,ä¸‹é¢çš„ä¾‹å­ä¸­,1ä»£è¡¨åˆšæ³¨å†Œ, 2ä»£è¡¨å·²ç»ç”³è¯·æˆåŠŸ,3ä»£è¡¨å…¶ä»–çŠ¶æ€,é‚£ä¹ˆåœ¨ç”³è¯·æ—¶çš„å¤„ç†å¦‚ä¸‹:

```java

public void apply(){
        if (state == 1){
            state = 2;
            message = "ç”³è¯·æˆåŠŸ.";
        } else if (state == 2){
            message = "ä½ å·²ç»ç”³è¯·è¿‡äº†.";
        } else {
            message = "ä½ è¿˜æ²¡æœ‰èµ„æ ¼ç”³è¯·.";
        }
    }
```

è¿™æ ·çš„ä»£ç ,å³ä½¿æŠŠé­”æ³•æ•°å­—å˜ä¸ºå¸¸é‡,å¯¹æ”¹è‰¯å¯è¯»æ€§çš„å¸®åŠ©ä¹Ÿæ˜¯æœ‰é™çš„.ä½†æ˜¯,å¦‚æœé‡‡ç”¨çŠ¶æ€æ¨¡å¼æ¥å¤„ç†,å°±ä¼šå˜å¾—ç®€å•,å¹¶ä¸”å…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§.

```java

   public interface State{
        public State apply() throws BusinessException;
    }
    
    public class Registered implements State{

        @Override
        public State apply() throws BusinessException {
            return new Applied();
        }
    }

    public class Applied implements State{

        @Override
        public State apply() throws BusinessException {
            return new BusinessException("ä½ å·²ç»ç”³è¯·è¿‡äº†.");
        }
    }

    public class Passed implements State{

        @Override
        public State apply() throws BusinessException {
            return new BusinessException("ä½ è¿˜æ²¡æœ‰èµ„æ ¼ç”³è¯·.");
        }
    }
    
    public void apply(){
        try {
            state = state.apply();
        } catch (BusinessException e){
            showMessage(e.getMessage());
        }
    }
```

## 3.3. å¯¹è®¾è®¡æ–¹æ³•ä¸äº†è§£

ç”±äºä»»åŠ¡åˆ’åˆ†ç­‰ç®¡ç†æ–¹é¢çš„åŸå› ,ç¨‹åºå‘˜è¢«å®šä½ä¸ºä¾ç…§åˆ«äººçš„è®¾è®¡è¿›è¡Œä»£ç åŠ å·¥çš„"ç å†œ",ä»¥è‡³äºç¨‹åºå‘˜å¾ˆå°‘èƒ½å¤Ÿæ€è€ƒè®¾è®¡æ–¹é¢çš„äº‹æƒ…,åªæ˜¯æœºæ¢°çš„å †ç Œä»£ç .åœ¨è¿™æ · çš„ä»»åŠ¡åˆ†é…æ¨¡å¼ä¸‹,ç¨‹åºå‘˜çš„èƒ½åŠ›å¾—ä¸åˆ°æå‡,ä¹Ÿå°±ä¸çŸ¥é“æ›´å¤šå¥½çš„è®¾è®¡æ–¹æ³•,è€Œå¯¹è®¾è®¡æ–¹æ³•çš„ä¸äº†è§£ä¼šé€ æˆå¾ˆå¤šä»£ç ä¸Šçš„é—®é¢˜.

ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å¯¹äºè®¾è®¡æ–¹æ³•ä¸äº†è§£è€Œé€ æˆçš„é—®é¢˜: 
- é‡å¤ä¸ç±»ä¼¼
- åŒ…ç»“æ„ä¸æ¸…æ™°
- ç±»è´£ä»»ä¸æ˜ç¡®
- å¸¸é‡æ•°æ®ç±»
- é•¿æ–¹æ³•
- å¤æ‚åˆ†æ”¯
- ç±»è†¨èƒ€
- ç±»çˆ†ç‚¸

ä¸äº†è§£è®¾è®¡æ–¹æ³•ä¼šåœ¨ä¸€ä¸ªç®€å•çš„é—®é¢˜ä¸Šè€—è´¹å¤§é‡çš„æ—¶é—´,æœ‰æ—¶ä¼šæŠŠä¸€ä¸ªç®€å•çš„é—®é¢˜å¤æ‚åŒ–,æœ‰æ—¶ä¼šé‡å¤å®ç°å·²æœ‰å®Œæ•´è§£å†³æ–¹æ¡ˆçš„ä»£ç ,æœ‰æ—¶åˆ™ä¼šåŸ‹ä¸‹bugéšæ‚£.

> é‚£ä¹ˆé—®é¢˜æ¥äº†, æ¡†æ¶çš„è®¾è®¡æ–¹æ³•è¯¥å¦‚ä½•äº†è§£é€å½»,ä»ä½•å…¥æ‰‹?

## 3.4. ç¼–ç¨‹ä¹ æƒ¯ä¸ä½³

### 3.4.1. æ²¡æœ‰ç®¡ç†å¥½ä»£ç çš„èŒè´£

æ¯”å¦‚åœ¨ä¸€ä¸ªç­‰çº§ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨ç¨‹åºä¸­éœ€è¦è¿›è¡Œç”µå­é‚®ä»¶çš„æ ¡éªŒ,é‚£ä¹ˆå¯¹äºç”µå­é‚®ä»¶æ ¡éªŒçš„ä»£ç ,å¦‚æœä¸æ³¨æ„å°±ä¼šç›´æ¥æ”¾åœ¨UIä»£ç ä¸­.ç„¶è€Œ,è¿™ä¸ªç”µå­é‚®ä»¶çš„æ ¡éªŒç¨‹åºå¯èƒ½åœ¨åˆ«çš„åœ°æ–¹è°ƒç”¨,é‚£ä¹ˆå°±æ— æ³•è®¿é—®è¿™ä¸ªæ–¹æ³•äº†.ä¸ºäº†æé«˜å¯é‡ç”¨æ€§,å¯ä»¥æŠŠè¿™ä¸ªæ–¹æ³•æ”¾åœ¨Utilç±»é‡Œé¢,æ”¾åœ¨Utilç±»é‡Œçš„è°ƒç”¨æƒ…å½¢æ˜¯è¿™æ ·çš„:

```java
Util.isEmail(user.email);
```

è¿™ä»ç„¶ä¸å¤Ÿå¥½,å› ä¸ºåœ¨ä¸Šé¢çš„ä»£ç ä¸­, emailæ˜¯String ç±»å‹.å½“éœ€è¦å‘é€ç”µå­é‚®ä»¶æ—¶éœ€è¦å°†ç”µå­é‚®ä»¶åœ°å€æºç¨‹"å§“å"<é‚®ä»¶åœ°å€>çš„å½¢å¼.å•çº¯çš„String
ç±»å‹ä¸èƒ½æ»¡è¶³è¦æ±‚.ä¹Ÿå°±æ˜¯è¯´, éœ€è¦ä¸€ä¸ªEmailAddressç±»æ¥å­˜å‚¨ä¸ç”µå­é‚®ä»¶åœ°å€ç›¸å…³çš„æ•°æ®.

```java

public class EmailAddress{
    String address;
    String name;
}

```

æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º: ç”µå­é‚®ä»¶çš„æ ¼å¼æ ¡éªŒåº”è¯¥æ”¾åœ¨ç”µå­é‚®ä»¶ç±»ä¸­å®ç°.

```java

public class EmailAddress{
    String address;
    String name;

    public boolean verify(){
        //æ–¹æ³•ä½“ç•¥.
    }
}
```

è¿™ä¸ªä¾‹å­è¯´æ˜äº†éšæ‰‹æ”¾ç½®æ–¹æ³•åŠŸèƒ½ä¼šå¯¼è‡´ä»£ç å¯å¤ç”¨æ€§é™ä½,èŒè´£æ··ä¹±ç­‰é—®é¢˜.


# 4. ç¬¬å…­ç«  ç¼–ç¨‹è¯­è¨€çš„å­¦ä¹ 

## 4.1. ç®€åŒ–çš„æ ¡éªŒæ¨¡å‹

å½“ä»å¤–éƒ¨è¾“å…¥ä¼ æ¥è¾“å…¥æ—¶è¦å¯¹å“åº”çš„æ•°æ®è¿›è¡Œæ ¡éªŒæ‰èƒ½å¤Ÿä½¿ç”¨.ä½†æ˜¯ä¼ ç»Ÿæ–¹æ³•æŠŠæ‰€æœ‰å‚æ•°éƒ½è¿›è¡Œå…¨é¢æ ¡éªŒ,å…‰æ ¡éªŒä»£ç å°±ä¼šå æ®ä¸€åŠä¸ªæ–¹æ³•çš„é•¿åº¦.ä¸‹é¢æ˜¯ä¸€ä¸ªå›¾ä¹¦ä¿¡æ¯ä¿å­˜çš„ä¾‹å­:

```java

    public  class BookAction{
        public void save(Book book) throws ValidationError{
            if (book.name == null || book.name.equals("")){
                throw new ValidationError("ä¹¦åä¸èƒ½ä¸ºç©º.");
            }
            if (book.isbn == null || book.isbn.equals("")){
                throw new ValidationError("ISBNä¸èƒ½ä¸ºç©º.");
            }
            if (book.press == null || book.press.equals("")){
                throw new ValidationError("å‡ºç‰ˆç¤¾ä¸èƒ½ä¸ºç©º.");
            }
            if (book.author == null || book.author.equals("")){
                throw new ValidationError("ä½œè€…ä¸èƒ½ä¸ºç©º.");
            }
            
            book.save();
        }
    }
```

ä¸ºäº†æ›´åŠ æ˜ç¡®ä»£ç çš„å«ä¹‰,é™„ä¸ŠBookç±»çš„å®šä¹‰å’ŒValidationExceptionç±»çš„å®šä¹‰

```java
    public class Book{
        public String name;
        public String author;
        public String press;
        public String isbn;
        
    }
    
    public class ValidationError implements Throwable{
        public String mMessage;
        public ValidationError(String message){
            mMessage = message;
        }
    }

```

å°±ä¸Šè¿°ä»£ç æ¥è¯´,å¤§é‡çš„æ ¡éªŒä»£ç ä½¿å¾—é˜…è¯»ä½“éªŒå¤§å¤§ä¸‹é™.
æœ‰ä¸€ç§ç›¸å¯¹ç®€å•çš„ä¿®æ”¹æ–¹å¼å°±æ˜¯å°†éç©ºåˆ¤å®šæå–åˆ°Utilç±»ä¸­å®Œæˆ.

ä¾‹å¦‚

```java
public class StringUtil{
        public static boolean isNullOrEmpty(String text){
            return text == null || text.equals("");
        }
    }
```
ä½†æ˜¯è¿™å¹¶ä¸èƒ½å¤Ÿç¼©å‡é•¿é•¿çš„åˆ¤å®šè¯­å¥,è€Œä¸”å¦‚æœå¢åŠ äº†é•¿åº¦æ ¡éªŒ,ç±»å‹æ ¡éªŒ(ä¾‹å¦‚ISBNå·åªèƒ½æ˜¯æ•°å­—å’ŒçŸ­çº¿,å¹¶ç¬¦åˆä¸€å®šè§„åˆ™)ç­‰,æ ¡éªŒä»£ç å°†ä»ç„¶ä¼šå˜é•¿

å¦‚æœé‡‡ç”¨è¿™ç§å½¢å¼æ¥ä¹¦å†™,ä»£ç çš„å¯è¯»æ€§å°±ä¸€å®šèƒ½å¤§å¤§æé«˜
```java
    public class BookAction{
        public void save(Book book){
            List<ValidateError> errors = validate(book);
            if (!errors.isEmpty()){
                render(errors);
                return;
            }
            book.save();
        }
        
        private List<ValidateError> validate(Entity entity){
            //è¿™é‡Œç©¶ç«Ÿè¯¥æ€ä¹ˆå†™å‘¢?åé¢å†æ¥åˆ†æ
        }
        
        private void render(List<ValidateError> errors){
            //å°†å„ç§é”™è¯¯æ¶ˆæ¯æ˜¾ç¤ºåœ¨æ­£ç¡®çš„ä½ç½®ä¸Š
        }
    }
    
    public class ValidateError{
        public String fieldName;
        public String errorText;
    }
```

å¦‚æœåªæ˜¯æŠŠä»¥å‰çš„æ ¡éªŒæ¢ä¸€ç§å½¢å¼å­˜æ”¾,é‚£ä¹ˆå¹¶ä¸èƒ½å¯¹æ•´ä½“å¯è¯»æ€§å¸¦æ¥å¤šå¤§ä¼˜åŠ¿,è€Œä¸”å¯å¤ç”¨æ€§ä¹Ÿä¸å¼º.æ‰€ä»¥,æ ¡éªŒåº”è¯¥å’ŒBookç±»æœ¬èº«åˆ†å¼€, å°†æ¥æ ¡éªŒå…¶ä»–å¯¹è±¡æ—¶ä¹Ÿå¯ä»¥é‡‡ç”¨åŒæ ·æœºåˆ¶è¿›è¡Œæ ¡éªŒ.

å¦‚æœå¯ä»¥é€šè¿‡è¿™ç§å½¢å¼å¯¹Bookè¿›è¡Œå®šä¹‰,å…¶ä»–å¯¹è±¡ä¹Ÿå¯ä»¥é‡‡ç”¨åŒæ ·æ–¹å¼è¿›è¡Œå®šä¹‰,ä»£ç å°±å˜å¾—æ˜“è¯»å¥½æ‡‚,å¤ç”¨æ€§ä¹Ÿå¾—åˆ°äº†æé«˜

```java
 public class Book extends Entity{
        @Required
        public String name;
        @Required
        public String author;
        @Required
        public String press;
        @Required
        @MaxLength(17)
        public String isbn;
    }
```

ä¸Šè¿°Annotaionçš„å¯¹åº”å®šä¹‰å¦‚ä¸‹:
```java
    public @interface Required{

    }

    public @interface MaxLength{
        int value();
    }

```
é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½å®ç°å¯¹åº”çš„æ ¡éªŒå‘¢?
é™äºç¯‡å¹…åŸå› ,ä¸‹åˆ—ä»£ç ä¸ºç®€åŒ–æ ¡éªŒæ¨¡å‹,åªå¤„ç†Stringç±»å‹çš„æ•°æ®,å¤„ç†å…¶ä»–ç±»å‹çš„æ•°æ®åˆ™ä¼šå‘ç”Ÿé”™è¯¯.


```java
    public class BookAction {
        public List<ValidateError> validate(Book book) {
            List<ValidateError> errors = new ArrayList<>();
            java.lang.reflect.Field[] fields = book.getClass().getDeclaredFields();
            for (java.lang.reflect.Field field : fields) {
                Annotation[] annotaions = field.getDeclaredAnnotations();
                for (Annotation a : annotaions) {
                    if (a instanceof Required) {
                        if (ValidateUtil.isNullOrEmpty(field)) {
                            errors.add(new ValidateError(field, field.name + "ä¸èƒ½ä¸ºç©º."));
                        }
                    } else if (a instanceof MaxLength) {
                        if (field.length() > ((MaxLength) a).value()) {
                            errors.add(new ValidateError(field, field.name + "é•¿åº¦ä¸èƒ½è¶…è¿‡" + ((MaxLength) a).value() + "."));
                        }
                    }
                }
            }

            return errors;
        }
    }

```

è¿™æ ·,å°±å¯ä»¥é€šè¿‡Annotationæ¥å¤§å¹…åº¦ç®€åŒ–æ ¡éªŒä»£ç ,å¹¶ä¸”é€šè¿‡ä¸€ä¸ªé€šç”¨çš„æ ¡éªŒæ¥è¿›è¡Œå…¨éƒ¨çš„å¤„ç†.è¿˜å¯ä»¥è€ƒè™‘ä¸ºæ ¡éªŒæœºåˆ¶å¢åŠ å¯æ‰©å±•æ¥å£,ä¸ºæ–¹ä¾¿å…¶ä»–äººå¢åŠ è‡ªå·±çš„æ ¡éªŒæœºåˆ¶,ä¾‹å¦‚ç‰¹æ®Šçš„æ ¼å¼æ ¡éªŒç­‰.

## 4.2. ç®€åŒ–çš„æƒé™æ¨¡å‹

æƒé™æ ¡éªŒæ˜¯ä¸€èˆ¬ç³»ç»Ÿä¸­æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåŠŸèƒ½.å¯¹äºæƒé™è®¾è®¡çš„æ–¹æ³•ä¹Ÿæ˜¯å¤šç§å¤šæ ·çš„,è€Œé‡‡ç”¨æ³¨è§£è¿›è¡Œæƒé™æ¨¡å‹çš„è®¾è®¡ä¼šä½¿å®ç°å’Œå˜æ›´éƒ½å˜å¾—å¾ˆå®¹æ˜“.

é¡µé¢çš„æƒé™å£°æ˜æ–¹å¼:

```java

 public class Users extends Controller{
       @Permission(Authority.ALL)
       public String list(){}

       @Permission(Authority.ADMIN | Authority.SELF)
       public String edit(int id){}

       @Permission(Authority.ADMIN | Authority.SELF)
       public String save(int id){}
   }
```

è¿™æ˜¯ä¸€ä¸ª[ä»¥ä½æ©ç çš„æ–¹å¼](#é‡‡ç”¨ä½æ©ç å‡å°‘ç±»çš„ä¸ªæ•°)å®šä¹‰çš„ç±»,
è€Œä½¿ç”¨è¿™äº›æ•°æ®çš„æ–¹å¼å¯ä»¥é€šè¿‡ä¸‹é¢çš„ç±»æ¥å®ç°
```java
    public class Authority{
        public static final int ALL = 0xffffff;

        public static final int ROLE_MASK = 0x000fff;
        public static final int ADMIN = 0x000001;
        public static final int MANAGER = 0x000002;

        public static final int OWNER_SHIP = 0xfff000;
        public static final int SELF = 0x001000;
        public static final int OWNER = 0x002000;
    }


    public class Controller{
        public String invoke(String className, String methodName){
            Class clazz = Class.forName(className);
            Method method = clazz.getDeclaredMethod(methodName);
            Annotation permission = method.getDeclaredMethod("Permession");
            int authority = permission.value();
            int userPermission = session.get("USER_PERMISSION");
            if ((userPermission && Authority.ROLE_MASK & authority == 0)
                    && (userPermission & Authority.OWNER_SHIP & authority == 0)){
                return "no_permission";
            }
            
            return method.invoke(clazz.newInstance());
        }
    }
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,ä¸»è°ƒåº¦æ–¹æ³•åˆ©ç”¨å„ä¸ªæ–¹æ³•å®šä¹‰çš„æ³¨è§£æ¥åˆ¤å®šå…¶æƒé™,è¿™æ ·æ¯ä¸ªæ–¹æ³•å®šä¹‰å…¶è‡ªå·±çš„æƒé™å³å¯.é€šè¿‡è¿™æ ·çš„æ–¹æ³•æŠŠæƒé™åˆ†æ•£åˆ°å„ä¸ªæ–¹æ³•è‡ªèº«å»,æ¯”è¾ƒå®¹æ˜“åˆ¤æ–­å®šä¹‰çš„æ­£ç¡®æ€§,ä¹Ÿåˆ©äºç»´æŠ¤,è€Œé‡‡ç”¨é›†ä¸­å¼æƒé™åˆ¤å®šå®¹æ˜“äº§ç”Ÿé—æ¼å’Œé”™è¯¯.

# 5. ç¬¬7ç«  è®¾è®¡æ–¹æ³•çš„å­¦ä¹ 


## 5.1. è®¾è®¡æ¨¡å¼

- åˆ›å»ºå‹æ¨¡å¼:
  - æŠ½è±¡å·¥å‚:åˆ›å»ºå‡ ç±»å®¶æ—çš„å®ä¾‹
  - æ„å»ºè€…:æŠŠå¯¹è±¡çš„æ„å»ºå’Œå®ƒåˆ†å¼€
  - å·¥å‚æ–¹æ³•:åˆ›å»ºä¸€ä¸ªå…±é€šæ¥å£çš„è‹¥å¹²ä¸ªå­ç±»çš„å®ä¾‹
  - åŸå‹:åˆ›å»ºä¸€ä¸ªè¢«å®Œæ•´åˆå§‹åŒ–çš„å®ä¾‹ç”¨äºå¤åˆ¶æˆ–è€…å…‹éš†
  - å•ä¾‹:ä½¿ä¸€ä¸ªç±»æ— è®ºåœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®éƒ½å¯ä»¥å¾—åˆ°å”¯ä¸€çš„å®ä¾‹
- ç»“æ„æ€§æ¨¡å¼:
  - é€‚é…å™¨:ä¸ºå¤šä¸ªä¸åŒçš„ç±»ä¹‹é—´å»ºç«‹è¿æ¥çš„æ¥å£
  - æ¡¥æ¥:å¯¹è±¡æœ‰å¤šä¸ªå±æ€§æ—¶æŠŠå±æ€§ä¹‹é—´çš„å…³è”å…³ç³»ä»m*næ”¹ä¸ºm+n
  - è£…é¥°:åŠ¨æ€çš„ä¸ºå¯¹è±¡å¢åŠ è´£ä»»
  - å¤–è§‚:é€šè¿‡ä¸€ä¸ªæ¥å£æ¥éšè—æ•´ä¸ªå­ç³»ç»Ÿ
  - äº«å…ƒ:ç”¨ä¸€ä¸ªå…±äº«çš„å®ä¾‹æ¥åŠ å¿«è®¿é—®
  - ä»£ç†:ç”¨ä¸€ä¸ªå¯¹è±¡ä»£è¡¨å¦ä¸€ä¸ªå¯¹è±¡
- è¡Œä¸ºå‹æ¨¡å¼:
  - èŒè´£é“¾:åœ¨ä¸€ä¸ªé“¾æ¡é—´ä¼ é€’ä»»åŠ¡
  - å‘½ä»¤:æŠŠå‘½ä»¤åŒ…è£…ä¸ºå¯¹è±¡
  - ç¿»è¯‘è€…:åœ¨ä¸€ä¸ªè¯­è¨€ç¯å¢ƒä¸­ä¸åŒçš„è¯­è¨€å…ƒç´ è¡¨ç¤ºä¸åŒçš„è¯­ä¹‰
  - è¿­ä»£è€…:å¾ªç¯åœ°è®¿é—®ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ 
  - åè°ƒè€…:åœ¨å¯¹è±¡ä¹‹é—´å»ºç«‹ä¸€ä¸ªç®€åŒ–çš„æ²Ÿé€šç±»
  - å¤‡æ³¨:å­˜å‚¨å¯¹è±¡å†…éƒ¨çš„æ•°å€¼
  - è§‚å¯Ÿå€¼:å½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥ä¸€ç»„å…¶ä»–å¯¹è±¡
  - çŠ¶æ€:å½“å¯¹è±¡çš„çŠ¶æ€å˜æ›´æ—¶å˜æ›´å¤„ç†
  - ç­–ç•¥:é‡‡å–ä¸åŒçš„ç®—æ³•è¿›è¡Œä¸åŒçš„å¤„ç†
  - æ¨¡æ¿æ–¹æ³•:æŠŠé€šç”¨çš„å¤„ç†æ”¾åœ¨çˆ¶ç±»,å…·ä½“çš„å®ç°æ­¥éª¤æ”¾åœ¨å­ç±»ä¸­å®ç°
  - è®¿é—®è€…:ä¸å¿…æ”¹å˜å¯¹è±¡å®šä¹‰çš„æƒ…å†µä¸‹å®šä¹‰åº”ç”¨äºå¯¹è±¡çš„æ“ä½œ

## 5.2. é‡‡ç”¨ä½æ©ç å‡å°‘ç±»çš„ä¸ªæ•°

### 5.2.1. ä½æ©ç 

ä½æ©ç çš„æ„æ€æ˜¯,å¯¹äºä¸€ä¸ªæ•°å­—çš„æ¯ä¸€ä½ä½œä¸ºä¸€ä¸ªå¼€å…³çš„æ ‡å¿—.å½“è‹¥å¹²ä¸ªä½åœ¨ä¸€èµ·æ—¶,å¯ä»¥è¡¨å¾çš„çŠ¶æ€å°±è¾¾åˆ°2çš„
næ¬¡æ–¹ä¹‹å¤š.å¦‚æœåŒæ ·çš„ç»„åˆéƒ½å†™æˆç±»,é‚£ä¹ˆç´¯çš„æ•°é‡å°±ä¼šæ€¥å‰§ä¸Šå‡.ä½æ©ç æ˜¯ä¸€ä¸ªå¾ˆå¥½åœ°å‡å°‘ç±»æ•°é‡çš„æ–¹æ³•.ä½æ©ç å¯ä»¥ç”¨æ¥ç®¡ç†å¤šç§ä¸åŒç»´åº¦çš„å˜åŒ–.ä¾‹å¦‚:


```java
public static final int BIT_MASK_COLOR = 0x00f;
public static final int BIT_MASK_SHAPE = 0xff0;

public static final int COLOR_RED = 0x001;
public static final int COLOR_GREEN = 0x002;
public static final int COLOR_YELLOW = 0x003;

public static final int SHAPE_RECTANGLE = 0x010;
public static final int SHAPE_CIRCLE = 0x020;
public static final int SHAPE_TRIANGLE = 0x040;
public static final int SHAPE_ELLIPSE = 0x080;


```

å°±ä¸Šè¿°ç»„åˆæ¥è¯´,çº¢è‰²çŸ©å½¢çš„å€¼ä¸º0x011,ç»¿è‰²ä¸‰è§’å½¢ä¸º0x022.

å¯¹äºä½æ©ç çš„è¿ç®—æ˜¯é€šè¿‡æˆ–è¿ç®—`|`æ¥å°†å¤šç§ä½æ©ç ç»„åˆåœ¨ä¸€èµ·çš„,è€Œé€šè¿‡ä¸è¿ç®—`&`æ¥è®¡ç®—å…¶ä¸­å¯¹åº”çš„ä½æ˜¯ON è¿˜æ˜¯ OFF.

å°±ä¸Šè¿°ä¾‹å­æ¥è¯´,è·å¾—ä¸€ä¸ªç‰©ä½“çš„é¢œè‰²ç”¨object & MASK_COLOR;
è·å–ä¸€ä¸ªç‰©ä½“çš„å½¢çŠ¶,ç”¨object & MACK_SHAPE;
åˆ¤å®šé¢œè‰²æ˜¯å¦ä¸ºç»¿è‰², åˆ™ç”¨if(object & COLOR_GREEN == COLOR_GREEN){}


### æ›¿ä»£å¤šæ€

æœ‰æ—¶é‡‡ç”¨å¤šæ€ä¼šäº§ç”Ÿå¤§é‡çš„ç±»,è€Œé‡‡ç”¨ä½æ©ç åˆ™å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­å®Œæˆç­‰ä»·çš„æ“ä½œ.

ä¾‹å¦‚æ–‡æœ¬æ¡†çš„è¾“å…¥é™åˆ¶,æ–‡æœ¬æ¡†å¯ä»¥è¾“å…¥æ•°å­—,ç”µå­é‚®ä»¶,ç”µè¯å·ç ,å¯†ç ,æ—¶é—´,é‚®æ”¿åœ°å€,å§“å,å§“åæ‹¼å†™ç­‰ä¸åŒå†…å®¹.æ¯ç§ç±»å‹æœ‰æ¶‰åŠæ˜¯å¦è‡ªåŠ¨å¤§å°å†™.æ•°å­—è¿˜æ¶‰åŠæ˜¯å¦å…è®¸è¾“å…¥å°æ•°,æ˜¯å¦å…è®¸è¾“å…¥ç¬¦å·.

è¯•æƒ³ä¸€ä¸‹,éœ€è¦å¤šå°‘ä¸ªç±»æ‰èƒ½è¡¨å¾è¿™äº›ä¸åŒçš„çŠ¶æ€?

ä¸‹é¢æ˜¯ä¸€äº›ç®€å•çš„å°è¯•:

```java

    public class EditText{
        public AutoCaps autoCaps;
        public InputType inputType;
        enum AutoCaps{ CAPS_SENTENSE, CAPS_CHAR, CAPS_WORD}
    }
    
    public interface InputType{
        public char filterInput(char text);
    }
    
    public class Number implements InputType{

        @Override
        public char filterInput(char text) {
            return 0;
        }
    }

    public class Email implements InputType{

        @Override
        public char filterInput(char text) {
            return 0;
        }
    }
    
```
ä½†æ˜¯å¦‚æœé‡‡ç”¨ä½æ©ç å°±ç›¸å¯¹ç®€å•å¾—å¤š.

```java  
    public class InputType{
        public static final int MASK_CONSTRAINT = 0x00fff;
        public static final int CONSTRAINT_NUMBER = 0x00001;
        public static final int CONSTRAINT_EMAIL = 0x00002;
        public static final int CONSTRAINT_PHONE = 0x00008;
        public static final int MASK_AUTO_CAPS = 0xff000;
        public static final int CAPS_SENTENSE = 0x01000;
        public static final int CAPS_WORD = 0x02000;
        public static final int CAPS_CHAR = 0x04000;
        
        public static final int MASK_NUMBER = 0xff000;
        public static final int SIGNED = 0x01000;
        public static final int DECIMAL = 0x02000;
    }
    

```


è¿™æ ·,åªéœ€ä¸€ä¸ªç±»å°±å¯ä»¥å®ç°è¯¥åŠŸèƒ½,å¹¶ä¸”ç”±äºè®¸å¯é•¿åº¦è¶³å¤Ÿé•¿,è¿˜å…·æœ‰å……åˆ†çš„å¯æ‰©å±•æ€§.Androidçš„æ–‡æœ¬æ¡†å±æ€§å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹æ³•è®¾è®¡çš„.å®é™…ä¸Šå®ƒæ”¯æŒçš„å±æ€§éå¸¸å¤š,å®ç°ä¸Šä¹Ÿè¦æ¯”è¿™ä¸ªæ¨¡å‹å¤æ‚å¾—å¤š.

åŒæ ·,å¯¹äºä¸€ä¸ªçª—å£æ¥è¯´,æœ‰æ ‡é¢˜æ ,æœ€å¤§åŒ–æŒ‰é’®,æœ€å°åŒ–æŒ‰é’®,å…³é—­æŒ‰é’®,å›¾æ ‡,çª—ä½“å¤–æ¡†,çŠ¶æ€æ ,å·¥å…·æ ,èœå•æ ç­‰å¤šç§å±æ€§,ä¹Ÿå¯ä»¥ç”¨ä½æ©ç çš„æ–¹å¼æ¥å®ç°.


### æ›¿ä»£å¤šæ€æšä¸¾

æœ‰æ—¶å€™å¸¸é‡å®šä¹‰é‡‡ç”¨æšä¸¾,ä½†æ˜¯é‡‡ç”¨æšä¸¾ä¹‹åçš„å¸¸é‡å¦‚æœéœ€è¦å¹¶åˆ—æ—¶,å°±è¦é€šè¿‡`||` ç¬¦å·æˆ–è€…æ•°ç»„æ¥å®šä¹‰,è¿™ä¼šå¢åŠ ä»£ç çš„é•¿åº¦ä»¥åŠåˆ¤å®šçš„å¤æ‚åº¦.ä¾‹å¦‚:

```java
   public enum Authority{
        ADMINISTRATOR, MANAGER, OPERATOR;
    }
```
å½“è§’è‰²æœ‰åå¤šç§æ—¶,åˆ¤å®šä¸€ä¸ªé¡µé¢æ˜¯å¦æœ‰æƒé™è®¿é—®çš„å¤„ç†ä¼šæ˜¯è¿™æ ·çš„:
```java  
    if (permission == Authority.ADMINISTRATOR
       || permission == Authority.MANAGER
       || permission == Authority.OPERATOR){
        
    }
```
è¿™æ ·çš„ä»£ç éœ€è¦åˆ°å¤„å†™,ä¼šå¾ˆéº»çƒ¦.
å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨è®²è§£,å†™æˆè¿™æ ·:

```java    
    
    @Permission(allowed == new Authority[]{
            Authority.ADMINISTRATOR, Authority.MANAGER
    });
```

å¯¹åº”ä¸Šè¿°æ³¨è§£çš„åˆ¤å®šè¯­å¥ä¸º:
```java
    Annotation permission = method.getDeclaredAnnotation("Permission");
    boolean allowed = false;
    for (Authority authority : permission.allowed){
        if (authority == user.permission){
            allowed = true;
            break;
        }
                
    }
    
    if (!allowed){
        return;
    }
```

è€Œå¦‚æœé‡‡ç”¨ä½æ©ç çš„å½¢å¼å°±å¯ä»¥å†™æˆ:
```java
    @Permission(Authority.ADMINISTRATOR | Authority.MANAGER)
```
è°ƒç”¨æ—¶:
```java    
    Permission permission = method.getDeclaredAnnotation("Permission");
    if (user.permission & permission.value() == user.permission){
        
    }
```

ç›¸å¯¹æ¥è¯´,æœ€åä¸€ç§å†™æ³•æœ€ä¸ºç®€ç»ƒ.

# ç¬¬ 9 ç«  ç¼–ç¨‹ä¹ æƒ¯çš„æ”¹è¿›

## ç»“æ„æ–¹é¢çš„æ”¹è¿›

### ç¼©çŸ­é•¿åˆ¤å®š

3. å»æ‰nullåˆ¤å®š 

å¾ˆå¤šæ—¶å€™,ä¸ºäº†é¿å…å‘ç”ŸNullPointException,éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œéç©ºåˆ¤å®š.
ç„¶å,å¦‚æœåˆ©ç”¨äº†ç©ºå¯¹è±¡æ¨¡å¼,è¿™ä¸ªåˆ¤å®šå°±æ²¡æœ‰å¿…è¦äº†.

ä¾‹å¦‚: åœ¨Androidè¾“å…¥æ³•ä¸­,å½“é”®ç›˜å¯åŠ¨æ—¶,å¤„åœ¨ä¸€ä¸ªä¸éœ€è¦ç°å®é”®ç›˜çš„é¡µé¢æ—¶,keyboardå¯¹è±¡ä¸ºç©º, é‚£ä¹ˆå¯¹äºæ‰€æœ‰é”®ç›˜çš„å¤„ç†ä½ç½®,éƒ½éœ€è¦å¢åŠ ä¸‹é¢çš„åˆ¤å®š

```java
if (keyboard == null){
    return;
}

```

ä¸‹é¢å°±æ˜¯ä¸€æ®µä¾‹å­ä»£ç :

```java

public class InputMethod extends InputMethodService{
    Keyboard mKeyboard;
    public void onCreate(){
        //æ ¹æ®æƒ…å†µ,å°†mKeyboardåˆå§‹åŒ–ä¸ºSoftKeyBoard
        //æˆ–è€…HardKeyBoardå®ä¾‹,æœ‰æ—¶ä¹Ÿä¸ä¼šç”Ÿæˆ
        //æ¯”å¦‚åœ¨æ’å…¥ç¡¬ç›˜å¯åŠ¨åˆ°ä¸€ä¸ªä¸å¯ä»¥è¾“å…¥çš„é¡µé¢æ—¶
        
    }

    public boolean onKeyDown(int keyCode, KeyEvent event){
        if (mKeyboard == null){
            return;
        }
    }
}
```

ä½†æ˜¯,å¦‚æœåœ¨åˆå§‹åŒ–é”®ç›˜æ—¶,æ ¹æ®æƒ…å†µå°†é”®ç›˜ç”Ÿæˆä¸ºSoftKeyboard,HardKeyboardæˆ–è€…InvisibleKeyboard,åˆ™åœ¨è°ƒç”¨é”®ç›˜æ—¶å°±ä¸å¿…åˆ¤å®šé”®ç›˜æ˜¯å¦ä¸ºç©º.

```java
public class MyInputMethod extends InputMethodService{
    Keyboard mKeyboard;
    public void onCreate(){
        //å¦‚æœä¸èƒ½åˆå§‹åŒ–ä¸ºSoftKeyboardæˆ–è€…HardKeyboard
        //åˆ™åˆå§‹åŒ–ä¸ºInvisibleKeyboard
    }

    public boolean onKeyDown(int keyCode, KeyEvent event){
        return mKeyboard.onKeyDown(keyCode, event);
    }
}


public interface Keyboard{
    public boolean onKeyDown(int keyCode, KeyEvent event);
}

public class SoftKeyboard implements Keyboard{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        //å…·ä½“è½¯é”®ç›˜å¤„ç†
    }
}

public class HardKeyboard implements Keyboard{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        //å…·ä½“ç¡¬é”®ç›˜å¤„ç†
    }
}

public class InvisibleKeyboard implements Keyboard{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        return false; // ç›´æ¥å°†æŒ‰é”®åŠ¨ä½œäº¤ç»™åº”ç”¨ç¨‹åºå¤„ç†
    }
}

```

é€šè¿‡è¿™æ ·ä¸€ä¸ªæ–°çš„ç±»,InvisibleKeyboardå¯ä»¥å°†è¯¸å¤šçš„if(mKeyboard == null) çš„åˆ¤å®šè§„é¿æ‰,ä»è€Œé™ä½ä»£ç çš„å¤æ‚åº¦.


4. çŠ¶æ€æ¨¡å¼ -- å‡å°‘åˆ¤å®šçš„æ¬¡æ•°


å¯¹äºå¤æ‚çš„åˆ¤å®šæ¡ä»¶,å¦‚ä½•æ‰èƒ½å‡å°‘åˆ¤å®šçš„å±‚æ•°å‘¢?ä¸‹é¢ä»‹ç»ä¸€ä¸‹çŠ¶æ€æ¨¡å¼.ä¾‹å¦‚åœ¨è¾“å…¥ç¨‹åºä¸­,æ ¹æ®å€™è¡¥æ˜¾ç¤ºçŠ¶æ€çš„ä¸åŒ,æŒ‰ä¸‹è¿”å›é”®çš„å¤„ç†ä¹Ÿä¸åŒ.

```java
public class Candidate{
    public int state;
    public int rowCount;
    public boolean visible;
    private static final int NORMAL_VIEW = 0;
    private static final int FULL_SCREEN = 1;
    private static final int CLOSED = 2;

    public boolean onKeyDown(int keyCode, KeyEvent event){
        if (keyCode == KeyEvent.KEYCODE_BACK){
            if (state == NORMAL_VIEW
                && rowCount == 1
                && visible == true){ // åªæœ‰ä¸€è¡Œå€™è¡¥æ—¶
                    visible = false;
                    state = CLOSED; // å…³é—­å€™è¡¥
            } else if (state == NORMAL_VIEW
                && rowCount > 1
                && visible == true){ // æœ‰å¤šè¡Œå€™è¡¥,ä½†æ˜¯åªæ˜¾ç¤ºç¬¬ä¸€è¡Œæ—¶
                visible = false;
                state = CLOSED;
                    
            } else if (state == FULL_SCREEN){
                state = NORMAL_VIEW; // è¿”å›å•è¡Œæ˜¾ç¤º
            } else if (state == CLOSED){
                MyInputMethod.getInstance().hideWindow();//å…³é—­è¾“å…¥æ³•
            }
        }
    }
}

```

å…¶ä¸­,å¯¹äºcandidateView.stateçš„åˆ¤å®šå¦‚æœæ”¹ä¸ºçŠ¶æ€æ¨¡å¼,åˆ™æ•´ä½“ä»£ç çš„é€»è¾‘ç»“æ„ä¼šå˜å¾—ç®€å•.

```java
public class Candidate{
    public interface State{
        public State onKeyBack();
    }

    public State state;

    public boolean onKeyDown(int keyCode, KeyEvent event){
        if (keyCode == KeyEvent.KEYCODE_BACK){
            state = state.onKeyBack();
        }
    }
}

public class Normal implements Candidate.State{
    public State onKeyBack(){
        return new Closed(); // å…³é—­å€™è¡¥
    }
}

public class FullScreen implements Candidate.State{
    public State onKeyBack(){
        return new Normal(); // å•è¡Œæ˜¾ç¤º
    }
}

public class Closed implements Candidate.State{
    public State onKeyBack(){
        MyInputMethod.getInstance().hideWindow(); // å…³é—­è¾“å…¥æ³•
        return this;
    }
}

```

è¿™æ ·, åŸæœ¬éœ€è¦é•¿åˆ†æ”¯æ‰èƒ½å¤Ÿå¤„ç†çš„onKeyDownä¸­çš„BACKæŒ‰é”®å¤„ç†,åˆ†æ•£åˆ°å„ä¸ªçŠ¶æ€ç±»ä¸­å®ç°, åˆ™onKeyDownæ–¹æ³•ä¸­çš„BACK æŒ‰é”®å¤„ç†å˜æˆäº†ä¸€å¥è¯.


### ç¼©çŸ­é•¿åˆ†æ”¯

2. ç­–ç•¥æ¨¡å¼

```java
å¯¹ä¸åŒçš„æŒ‰é”®è¿›è¡Œåˆ†ç»„, åˆ›å»ºä¸€ä¸ªæ¥å£ KeyProcessor;

public interface KeyProcessor {
    public boolean onKeyDown(int keyCode, KeyEvent event);
    public boolean onKeyUp(int keyCode, KeyEvent event);
}
```

ç„¶ååˆ›å»ºå‡ ä¸ªå¤„ç†å™¨

```java

public ArrowKeyProcessor implements KeyProcessor{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        // å¤„ç†æ–¹å‘é”®æŒ‰ä¸‹
    }

    public boolean onKeyUp(int keyCode, KeyEvent event){
        // å¤„ç†æ–¹å‘é”®æŠ¬èµ·
    }
}


public ChannelKeyProcessor implements KeyProcessor{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        // å¤„ç†æ–¹å‘é”®æŒ‰ä¸‹
    }

    public boolean onKeyUp(int keyCode, KeyEvent event){
        // å¤„ç†æ–¹å‘é”®æŠ¬èµ·
    }
}
```

ä»¥æ­¤ç±»æ¨

è¿™æ—¶, åœ¨ä¸»ä½“ç¨‹åºä¸­, æ ¹æ®æŒ‰é”®çš„ç±»å‹ä¸åŒ,é‡‡ç”¨ä¸åŒçš„å¤„ç†å™¨è¿›è¡ŒæŒ‰é”®å¤„ç†,è¿™æ ·ä¸»ä½“ç¨‹åºä¸­çš„æŒ‰é”®å¤„ç†å°±ä¼šå¤§å¹…åº¦ç¼©çŸ­.

```java
public class HardKeyboard{
    public boolean onKeyDown(int keyCode, KeyEvent event){
        if (event.isPrintingKey()){
            // å¤„ç†è¾“å…¥æŒ‰é”®;
            return true;
        }

        try {
            KeyProcessor processor = 
             KeyProcessorFactory.createKeyProcessor(keyCode);
            processor.onKeyDown(keyCode, event);
            return true;
        } catch (Exception e){
            return false; // å‘ç”ŸException è¡¨ç¤ºä¸åœ¨å¤„ç†èŒƒå›´å†…,äº¤ç”±Appå¤„ç†
        }
    }
}
```

å®ç°ä¸»ä½“ä»£ç ä¹‹å, åœ¨KeyProcesscorFactoryä¸­æ ¹æ®è¾“å…¥çš„KeyCodeæ¥ç”Ÿæˆå¯¹åº”çš„KeyProcessorå¯¹è±¡.å¦‚æœç›´æ¥æŒ‰ç…§æŒ‰é”®è¿›è¡Œswitch-case, é‚£ä¹ˆåªæ˜¯å°†ä»£ç å¤æ‚çš„é—®é¢˜è½¬ç§»äº†,å¹¶æ²¡æœ‰è§£å†³é—®é¢˜.

```java

public class KeyProcessorFactory{
    private static Map<Integer, String> 
        keyMaps = new HashMap<Integer, String>();
    static{
        keyMaps.put(KeyEvent.KEYCODE_DPAD_CENTER, "Enter");
        keyMaps.put(KeyEvent.KEYCODE_ENTER, "Enter");
        keyMaps.put(KeyEvent.KEYCODE_LEFT, "Arrow");
        keyMaps.put(keyEvent.KEYCODE_RIGHT, "Arrow");
    }

    public static KeyProcessor createKeyProcessor(int keyCode) throws ClassNotFoundException,
                    InstantiationException,
                    IllegalAccessException{
        String processorName = keyMaps.get(KeyEvent.KEYCODE_DPAD_CENTER);
        Class processor = 
            Class.forname("com.otrois.inputmethod.keyprocessor."
            + processorName
            + "KeyProcessor");
        return (KeyProcessor)processor.newInstance();
    }
}

```

è¿™ç§æ‰‹æ³•å°†ä¼šå¤§å¹…åº¦ç¼©å‡å¤„ç†å¤æ‚åº¦ä»¥åŠä»£ç é‡, ä½†æ˜¯ä¼šäº§ç”Ÿå¤šä¸ªç±».ä¸è¿‡,è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºXMLæ¥ç®¡ç†å„ä¸ªæŒ‰é”®çš„å½’å±,ä»è€Œè¿›ä¸€æ­¥ç®€åŒ–ä»£ç ,å¹¶ä¸”è®©ä»£ç å…·æœ‰æ›´é«˜çš„å¯æ‰©å±•æ€§.

3. å»æ‰return å‰çš„åˆ¤å®š

å…ˆçœ‹ä¸‹åˆ—ä»£ç : 

```java

public boolean hasMore(){
    if (list.size() > 0){
        return true;
    }
    return false;
}
```

è¿™æ®µä»£ç çš„æ„å›¾å¾ˆæ˜æ˜¾, å½“listä¸­æœ‰å…ƒç´ æ—¶å°±è¿”å›true, å¦åˆ™è¿”å›false.

è¿™ä¸ªæ–¹æ³•åªè¦è¿”å›çš„æ˜¯booleanç±»å‹,ç¼–è¯‘å°±å¯ä»¥é€šè¿‡, è€Œbooleanç±»å‹ä¸ä»…ä»…æ˜¯å˜é‡, è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æ˜¯boolean ç±»å‹, ä¸ºäº†èƒ½å¤Ÿæ›´æ˜ç¡®è½¬æ¢è¿‡ç¨‹,å…ˆåšä¸€æ¬¡ä¸­é—´è½¬æ¢.

```java
public class boolean hasMore(){
    if ((list.size() > 0) == true){
        return true;
    }
    return false;
}


```

å¦‚æœæŠŠä¸­é—´çš„è¡¨è¾¾å¼list.size() > 0 æ›¿æ¢ä¸ºä¸€ä¸ªå˜é‡a,é‚£ä¹ˆä¸Šé¢çš„ä»£ç å…¶å®ç­‰ä»·äº

```java
public boolean hasMore(){
    return a;
}
```

åœ¨æ›¿æ¢å›æ¥, è¿™æ®µä»£ç å°±å¯ä»¥å†™å‡º:
```java
public boolean hasMore(){
    return list.size() > 0;
}
```

åƒè¿™æ ·, å¯ä»¥é€šè¿‡ç”¨è¡¨è¾¾å¼ä»£æ›¿å˜é‡çš„æ–¹å¼, æ¥å‡å°‘ä¸€æ¬¡åˆ¤å®š.

### å‡å°‘å‚æ•°ä¸ªæ•°

å‚æ•°ä¸ªæ•°è¿‡å¤šä¼šå¯¼è‡´: 1. ä»£ç å˜å¤æ‚,å—å½±å“èŒƒå›´å˜å¤§ 2. å¯è¯»æ€§é™ä½,éœ€è¦è®°å¿†å„ä¸ªå‚æ•°

å‡å°‘å‚æ•°ä¸ªæ•°çš„æ–¹æ³•æœ‰ä¸¤ç§: å¼•å…¥å‚æ•°å¯¹è±¡ ä¸æå–å…¨å±€å˜é‡

1. å¼•å…¥å‚æ•°å¯¹è±¡

ä¾‹å¦‚, ä¸€ä¸ªè®¡ç®—å™¨çš„åŠŸèƒ½

```java
public class Calculator{
    public int add(int a, int b){
        return a + b;
    }
}

public class Calculator{
    public int sub(int a, int b){
        return a - b;
    }
}

```

å¯è§, å¤šä¸ªæ–¹æ³•éƒ½é‡‡ç”¨äº†ç›¸åŒçš„å‚æ•°ç±»å‹, å³ä¸¤ä¸ªæ•´æ•°,å…¶å®å¯ä»¥åˆå¹¶ä¸€ä¸‹;

```java
public class Calculator{
    public class Parameter{
        public int a;
        public int b;
    }

    public int add(Calculator.Parameter param){
        return param.a + param.b;
    }

    public int sub(Calculator.Parameter param){
        return param.a - param.b;
    }
}

```

å…¶ä¸­, x,y,color éƒ½å¯ä»¥æå–ä¸ºæˆå‘˜å˜é‡, é‚£ä¹ˆæ–°çš„å½¢å¼å°±æ˜¯:

```java
public class Ball{
    int x, y, color;

    public void markHomeNeighbors(){
        
    }
}

```

### å‡å°‘åµŒå¥—çš„å±‚æ•°

åµŒå¥—å±‚æ•°è¶Šå¤š,ä»£ç è¶Šå¤æ‚, å…¶å…¨éƒ¨çš„å¤æ‚åº¦ä¹Ÿå°±å¯èƒ½è¶Šé«˜.å› æ­¤æ§åˆ¶åµŒå¥—å±‚æ•°æ˜¯é™ä½Bugå‘ç”Ÿæ¦‚ç‡çš„ä¸€ä¸ªæœ‰æ•ˆæ‰‹æ®µ

1.æå–æ–¹æ³•

ä¸‹é¢æ˜¯ä¸€æ®µä»£ç çš„æŸéƒ¨åˆ†ä¸»è¦é€»è¾‘,å®ƒæœ‰5å±‚åµŒå¥—,æ‘˜é™¤ä¸»è¦é€»è¾‘æ¥çœ‹çš„è¯éƒ½æœ‰ç‚¹å¤æ‚.

```java
if (ev.isPrintingKey()){//1
    if (mHardShift > 0 || ev.isShiftPressed()){//2
        if (charCode == 0){//3
            if (mHardShift == 1){
                mShiftPressing = false;
            }

            if (!ev.isShiftPressed()){
                if (mHardShift == 1){
                    mHardShift = 0;
                }
            }
        }
    }
}

```

1å’Œ2 ç”±äºæ˜¯ç›´æ¥åµŒå¥—,å¯ä»¥åˆå¹¶

è€Œ3å¤„ç†å¤ªé•¿,ä¸å®¹æ˜“ç†è§£,å¯ä»¥æå–æ–¹æ³•

è¿™æ ·,ä¸»è¦çš„é€»è¾‘ä»£ç å°±å˜æˆ:

```java
if (ev.isPrintingKey() && (mHardShift > 0 || ev.isShiftPressed())){
    processShift();
}

```

è€Œæå‡ºæ¥çš„3å¤„ç†å¦‚ä¸‹:

```java
private void processShift(){
    if (charCode == 0){//3
            if (mHardShift == 1){
                mShiftPressing = false;
            }

            if (!ev.isShiftPressed()){
                if (mHardShift == 1){
                    mHardShift = 0;
                }
            }
    }
}

```

è¿™æ ·å¯ä»¥é€šè¿‡æå–æ–¹æ³•é€æ­¥å‡å°‘åµŒå¥—çš„å±‚æ•°.ä½†æ˜¯è¿™å¹¶æ²¡æœ‰æ”¹å˜ä»£ç çš„å¤„ç†é€»è¾‘.å› æ­¤,ä»£ç çš„å®é™…å¤æ‚åº¦è¿˜æ˜¯æ¯”è¾ƒé«˜çš„.

2. æå‰åˆ¤å®š

å°†
```java
if (list != null){
    for (int i = 0; i < list.size(); i++){
        //è¿›è¡ŒæŸç§å¤„ç†
    }
}
```
æ”¹ä¸º:

```java
if (list == null){
    return;
}

for (int i = 0;i < list.size(); i++){
    
}

```

è¿™æ ·ä¿®æ”¹,å°±ä¸ä¼šå› ä¸ºåµŒå¥—è€Œå¯¼è‡´æ¢è¡Œç­‰é—®é¢˜.
å’Œæå–æ–¹æ³•ä¸€æ ·,æå‰åˆ¤å®šå¹¶æ²¡æœ‰æ”¹å˜ä»£ç æœ¬è´¨ä¸Šçš„å¤æ‚åº¦.

3. ç”¨whildä»£æ›¿for

```java
public void searchOld(){
    int[] temp = new int[]{23, 42, 52, 34, 66, 32, 59};
    boolean found = false;
    int index = 0;
    for (int i = 0; i < temp.length; i++){
        if (temp[i] == 67){
            found = true;
            index = i;
            break;
        }
    }

    if (found){
        System.out.println("index = " + index);
    } else {
        System.out.println("Not Found");
    }
}

// è°ƒæ•´å
public void searchNew(){
    int[] temp = new int[]{23, 42, 52, 34, 66, 32, 59};
    int index = 0;
    
    while (index < temp.lengh && temp[index] != 67){
        index ++;
    }
    
    if (index < temp.length){
        System.out.println("index = " + index);
    } else {
        System.out.println("Not Found");
    }
}
```

è¿™ä¸ªæ˜¯çœŸæ­£é™ä½åµŒå¥—å±‚æ•°çš„åšæ³•


2. æå–å…¨å±€å˜é‡

å½“æœ‰çš„å‚æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°è¿‡å¤šæ—¶, å¯ä»¥è€ƒè™‘å°†è¯¥å‚æ•°ä½œä¸ºå…¨å±€å˜é‡æ¥ä½¿ç”¨.ä¾‹å¦‚:
```java
public class Ball{
    public void markHomeNeighbors(int x, int y, int color){
        
    }
}

```



## åˆ†ç¦»æš§æ˜§å…³ç³»

ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»è¿‡äºæš§æ˜§å’Œçº ç¼ ä¸æ¸…,å°±ä¼šå¼•èµ·ä»£ç çš„è€¦åˆåº¦å¢é«˜.ä¸ºäº†é™ä½è€¦åˆåº¦,è¦å°½é‡åˆ†ç¦»æš§æ˜§å…³ç³».

### å¾ªç¯å¼•ç”¨

Aa.bå’ŒBb.aåŒæ—¶å­˜åœ¨,ä¸çŸ¥é“åˆ°åº•è°åŒ…å«äº†è°,ä¹‹æ‰€ä»¥å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºé™¤äº†åŸæœ¬æ­£ç¡®çš„AåŒ…å«Bçš„å…³ç³»ä¹‹å¤–,Bä¸­çš„è‹¥å¹²åœ°æ–¹è¿˜æ‰“ç®—è°ƒç”¨Aä¸­çš„æŸä¸ªå±æ€§æˆ–è€…æ–¹æ³•,æ‰€ä»¥å°±æŠŠAä½œä¸ºBçš„æˆå‘˜å˜é‡å¼•å…¥.
æ‹†ç¦»å¾ªç¯å¼•ç”¨çš„æ–¹æ³•æœ‰ä¸¤ç§:

**æ–¹æ³•1 å•ä¾‹æ¨¡å¼**

è®©Aå•ä¾‹,é‚£ä¹ˆBå¦‚æœè¦è°ƒç”¨A,å°±å¯ä»¥é€šè¿‡è·å¾—Açš„å®ä¾‹çš„æ–¹æ³•æ¥è°ƒç”¨Açš„æ–¹æ³•.ä¾‹å¦‚A.getInstance().xxx()


**æ–¹æ³•2 å¼•å…¥ä¸­é—´äºº**

a. å‘½ä»¤æ¨¡å¼(äº‹ä»¶é©±åŠ¨æœºåˆ¶)

å¼•å…¥ä¸­é—´ç±»C,å½“Bæœ‰ä»»ä½•éœ€è¦è°ƒç”¨Aæ—¶,é€šè¿‡Cå‘é€ä¸€ä¸ªæ¶ˆæ¯;å½“Aæœ‰ä»»ä½•éœ€è¦è°ƒç”¨Bçš„å¤„ç†æ—¶,ä¹Ÿé€šè¿‡Cå‘é€ä¸€ä¸ªæ¶ˆæ¯.

b. è°ƒåœè€…æ¨¡å¼

å¼•å…¥ä¸­é—´ç±»C,æŠŠAä½œä¸ºCçš„ä¸€ä¸ªæˆå‘˜å˜é‡,è€ŒCä½œä¸ºå•ä¾‹æ¨¡å¼å­˜åœ¨.é‚£ä¹ˆæƒ³è¦å¼•ç”¨Aæ—¶åº”è¯¥è¿™æ ·è°ƒç”¨C.getInstance().a.xxx();è¿™æ ·åšæ˜¯å› ä¸ºAå—åˆ°å…¶ä»–åˆ¶çº¦,ä¸é€‚åˆä½œä¸ºå•ä¾‹æ¨¡å¼å‡ºç°,åŒæ ·,Cä½œä¸ºä¸€ä¸ªå…¬å…±è°ƒåœè€…,ä¸ä»…ä»…ä¸ºAä½œå®¹å™¨,ä»–ä¹Ÿå¯èƒ½ä¸ºå…¶ä»–å†…å®¹ä½œå®¹å™¨.åœ¨å®é™…ä¾‹å­å½“ä¸­,å¯¹äºå…¨å±€çš„è®¾å®šå¯èƒ½å°±æ˜¯è¿™æ ·ä¸€ä¸ªç±».

### é—´æ¥ç»§æ‰¿

A->B->C çš„ç»§æ‰¿å…³ç³»: Cçªç„¶è¦è°ƒç”¨ä¸€ä¸ªè¢«Bé‡è½½äº†çš„æ–¹æ³•,ä½†æ˜¯å¹¶æ²¡æœ‰super.superè¿™ç§è°ƒç”¨æ–¹æ³•,è¿™æ˜¯é‡è½½é”™è¯¯é€ æˆçš„é—®é¢˜,ä¹‹æ‰€ä»¥Cæ‰“ç®—è°ƒç”¨Açš„æŸä¸ªæ–¹æ³•,è€Œä¸æ˜¯Bä¸­é‚£ä¸ªé‡è½½äº†çš„æ–¹æ³•,æ˜¯å› ä¸ºBä¸­é‡è½½çš„æ–¹æ³•çš„ä½œç”¨èŒƒå›´è¶…å‡ºäº†Cçš„é¢„æœŸ,Bä¸­çš„æ–¹æ³•è¿èƒŒçš„å•ä¸€èŒè´£åŸåˆ™,æ‰€ä»¥éœ€è¦ä¿®æ”¹Bä¸­çš„é‡è½½.å¦‚æœå®åœ¨æ— æ³•ä¿®æ”¹Bä¸­çš„é‡è½½,é‚£ä¹ˆå¯ä»¥åœ¨Bä¸­å¢åŠ ä¸€ä¸ªå¼•æ¡¥callSuper()æ¥è°ƒç”¨Cä¸­æƒ³è¦è°ƒç”¨çš„Açš„æ–¹æ³•,ç„¶ååœ¨Cä¸­è°ƒç”¨callSuper();é‡åˆ°è¿™ç§æƒ…å†µæ—ºæ—ºæ„å‘³ç€è®¾è®¡ä¸Šå‡ºç°é—®é¢˜äº†.

## å¤šç»´åº¦å˜åŒ–

åœ¨ä¸€äº›ç³»ç»Ÿä¸­ç³»ç»Ÿä¼šæœ‰è‹¥å¹²ä¸ªç»´åº¦çš„å˜é‡æ¥è¡¨ç¤ºç³»ç»Ÿçš„çŠ¶æ€.å½“è¿™äº›å˜é‡ç»„åˆåœ¨ä¸€èµ·æ—¶å®ƒä»¬æ‰€å½¢æˆçš„å„ç§å¯èƒ½æ€§ä¸º`m*n*......`å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç½‘æ ¼.å¦‚æœå°†è¿™äº›ç»„åˆæ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­,é‚£ä¹ˆå¯¹äºå½“å‰æ¡ä»¶æ‰€äº§ç”Ÿçš„åˆ¤å®šæ¡ä»¶ä¼šéå¸¸å¤š.

ä¾‹å¦‚,åœ¨ä¸€ä¸ªæ™ºèƒ½è®¾å¤‡ä¸Šçš„è¾“å…¥æ³•å¯èƒ½æœ‰å¦‚ä¸‹ç»„åˆæ¡ä»¶
- è¾“å…¥è®¾å¤‡:è½¯é”®ç›˜,ç¡¬é”®ç›˜,æ¸¸æˆæ‰‹æŸ„,é¥æ§å™¨  (4ç§æ¡ä»¶)
- è¯­è¨€:æ‹¼éŸ³,åŠ¡å¿…,å…¨è§’è‹±æ–‡,åŠè§’è‹±æ–‡,æ•°å­—   (5ç§æ¡ä»¶)
- é”®ç›˜æ¨¡å¼:12é”®,50é”®,QWERTYé”®ç›˜        (4ç§æ¡ä»¶)
- å€™è¡¥æ¨¡å¼:æ— ,ä¸€è¡Œ,å¤šè¡Œ;               (3ç§æ¡ä»¶)
- æ˜¯å¦æœ‰è¾“å…¥:æœ‰,æ— ;                   (2ç§æ¡ä»¶)

é‚£ä¹ˆå¯¹äºè¿™ç§æƒ…å†µ, å¦‚ä½•æ‰èƒ½å‡å°‘è€¦åˆåº¦,å‡å°‘åˆ¤å®šå¤„ç†çš„å¤æ‚åº¦å‘¢?ä¸‹é¢æ˜¯å®ç°æ–¹å¼:

```java
public abstract class AbstractKeyboard{
    public KeyMode keyMode;
}

public abstract class KeyMode{
    public Language language;
}

public abstract class Language{
    public boolean inputted;
}

public abstract class Candidate{
    
}

public class InputMethod{
    public AbstractKeyboard keyboard;
    public Candidate candidate;
}


```

åœ¨è¿™é‡Œæˆ‘ä»¬å°†å„ä¸ªç»´åº¦çš„å±æ€§æŒ‰ç…§é¡ºåºä¸€å±‚åŒ…è£…ä¸€å±‚.è¿™æ ·,å½“å„ä¸ªç»´åº¦å‘ç”Ÿå˜åŒ–æ—¶,æ‰€äº§ç”Ÿçš„å˜åŒ–æƒ…å½¢ä¸º `m + n + ......`,è¿™ç§æ–¹å¼å«åšæ¡¥æ¥æ¨¡å¼.

## è‡ªç›¸ä¼¼å¯¹è±¡

ä¸€èˆ¬æ¥è¯´, åœ¨çœ,å¸‚,åŒºè¿™ç§è¡Œæ”¿å•ä½ç»“æ„,éƒ¨é—¨ç»„ç»‡ç»“æ„æˆ–è€…å•†å“ç›®å½•çš„å±æ€§ç»“æ„é‡Œ,æ¯ä¸ªèŠ‚ç‚¹éƒ½å…·æœ‰ç›¸ä¼¼æ€§.æˆ‘ä»¬æŠŠè¿™ç§èŠ‚ç‚¹å…·æœ‰ç›¸ä¼¼æ€§çš„ç»“æ„ç§°ä¸ºè‡ªç›¸ä¼¼å¯¹è±¡.å¯¹äºè‡ªç›¸ä¼¼å¯¹è±¡,å¯ä»¥é‡‡ç”¨ç»„åˆè€…æ¨¡å¼è¿›è¡Œå¤„ç†.

ä¾‹å¦‚, è¦åˆ—å‡ºä¸€ä¸ªå›½å®¶çš„æ‰€æœ‰çš„åŸå¸‚åç§°,å¯ä»¥é€šè¿‡ä¸‹åˆ—æ–¹å¼è¿›è¡Œ:

```java
public abstract calss Place{
    public List<Place> subPlaces;
    public String name;
    public int id;
    public abstract void initSubs();

    private void output(){
        System.out.println(name);
    }

    public void listAll(){
        output();
        for (Place place : subPlaces){
            subPlaces.output();
        }
    }
}

public class Country extends Place{
    public void initSubs(){
        // load province from db with county.id.
    }
}

public class Province extends Place{
    public void initSubs(){
        // load city from db with province.id.
    }
}
```

è¿™æ ·, åˆ¶ä½œä¸€ä¸ªè”åŠ¨ä¸‹æ‹‰åˆ—è¡¨æ¡†æ˜¯åªè¦æŒ‡æ˜æ¯ä¸ªæ¡†æ‰€å¯¹åº”çš„ç±»å³å¯,è¿™ç§æ–¹æ³•å«åšç»„åˆè¿™æ¨¡å¼.

åŒæ ·,åˆ¶ä½œä¸€ä¸ªå·¥èµ„å…¬å¼ç¼–è¾‘å™¨æ˜¯,å¯ä»¥é‡‡ç”¨è‡ªç›¸ä¼¼è¡¨è¾¾å¼æ•°æ¥å®Œæˆ.

```java

public class ExpressionTree{
    public Node root;
}

public class Node{
    public Node left;
    public Node right;
    public String symbol;
    public double calculator(){
        Calculable calculator = 
            CalculatorFactory.createInstance(symbol);
        return calculator.calculate(left, right);
    }
}
```
è¿™æ ·åªè¦æ„å»ºäº†äºŒå‰æ ‘ç»“æ„çš„è¡¨è¾¾æ•°,å°±å¯ä»¥é€šè¿‡ä¸Šè¿°ç»“æ„é’ˆå¯¹æ¯ä¸ªå‘˜å·¥æ¥è®¡ç®—å·¥èµ„äº†.




# 6. å…¶ä»–
## 6.1. éšæœºæä¾›å™¨

å½“ä½¿ç”¨éšæœºçš„æ—¶å€™ä¸€ç§æ–¹æ³•æ˜¯`Utils.randomWeight()`
å¦å¤–ä¸€ç§æäº¤æ¨èçš„æ–¹å¼æ˜¯è‡ªå®šä¹‰ä¸šåŠ¡ç›¸å…³æ¥å£å’Œç±»

```java

/**
 * æä¾›éšæœºæ¦‚ç‡
 * 
 * @author iTerminator
 */
public interface GemRandomRateProvider {
	/**
	 * æç‚¼2ä¸ªé“å…·ç›¸åŒçš„æ¦‚ç‡
	 */
	int rate2();

	/**
	 * æç‚¼3ä¸ªé“å…·ç›¸åŒçš„æ¦‚ç‡
	 */
	int rate3();

	/**
	 * è®¾ç½®2ä¸ªå’Œ3ä¸ªç›¸åŒé“å…·çš„æ¦‚ç‡
	 * 
	 * @param r2
	 * @param r3
	 */
	public void rate(int r2, int r3);
}
```


```java
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

public class RandomGems {
	private int gem1;
	private int gem2;
	private int gem3;

	public RandomGems() {
	}

	public RandomGems(int gem1, int gem2, int gem3) {
		this.gem1 = gem1;
		this.gem2 = gem2;
		this.gem3 = gem3;
	}

	public int getGem1() {
		return gem1;
	}

	public void setGem1(int gem1) {
		this.gem1 = gem1;
	}

	public int getGem2() {
		return gem2;
	}

	public void setGem2(int gem2) {
		this.gem2 = gem2;
	}

	public int getGem3() {
		return gem3;
	}

	public void setGem3(int gem3) {
		this.gem3 = gem3;
	}

	public void addGem(int itemId) {
		if (gem1 == 0) {
			gem1 = itemId;
		} else if (gem2 == 0) {
			gem2 = itemId;
		} else if (gem3 == 0) {
			gem3 = itemId;
		}
	}

	public int getSameItemId() {
		if (gem1 == gem2 || gem1 == gem3) {
			return gem1;
		}
		if (gem2 == gem3) {
			return gem2;
		}
		return 0;
	}

	public boolean isTwoPair() {
		return gem1 == gem2 || gem1 == gem3 || gem2 == gem3;
	}

	public boolean isThreePair() {
		return gem1 == gem2 && gem1 == gem3;
	}

	public boolean isFull() {
		return gem1 != 0 && gem2 != 0 && gem3 != 0;
	}

	/**
	 * æ˜¯å¦å­˜åœ¨å®çŸ³
	 * 
	 * @param itemId
	 * @return
	 */
	public boolean hasGem(int itemId) {
		return gem1 == itemId || gem2 == itemId || gem3 == itemId;
	}

	public void random() {
		List<Integer> allGems = new ArrayList<Integer>(Arrays.asList(gem1, gem2, gem3));
		Collections.shuffle(allGems);
		gem1 = allGems.get(0);
		gem2 = allGems.get(1);
		gem3 = allGems.get(2);
	}

	@Override
	public String toString() {
		return gem1 + " " + gem2 + " " + gem3;
	}

}

```

## åœ¨æ—§ä»£ç åŸºç¡€ä¸Šæ‰©å±•ç±»ä¼¼åŠŸèƒ½

- åˆ©ç”¨æ¥å£çš„æ€æƒ³


æ¯”å¦‚å·²æœ‰ä¸€ä¸ªABuffç±»,ç°éœ€è¦å¢åŠ å¦ä¸€ç§BBuffçš„ç±»å‹,è¿™æ ·å¯ä»¥å®šä¹‰ä¸€ä¸ªIBuffæ¥å£,è®©ABuffå’ŒBBufféƒ½å®ç°å®ƒ



ä¹‹åæŠŠæ¥å£å½“åšä¸€ä¸ªå‚æ•°, ä¼ å…¥ä¹‹å‰è°ƒç”¨çš„æ–¹æ³• å†…, è¾¾åˆ°æ²¡æœ‰ä¿®æ”¹åŸæ¥ä»£ç çš„ç›®çš„
